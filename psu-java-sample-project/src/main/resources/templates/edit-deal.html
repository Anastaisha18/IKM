<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Редактировать сделку</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<div class="container mt-4">
    <div class="form-container">
        <h2 class="mb-4"><i class="bi bi-pencil"></i> Редактировать сделку</h2>

        <div class="alert alert-info mb-4">
            <strong>ID сделки:</strong> <span th:text="${deal.id}"></span> |
            <strong>Стадия:</strong> <span class="badge"
                                           th:classappend="${deal.stage == 'Закрыта' ? 'bg-success' :(deal.stage == 'В работе' ? 'bg-primary' : 'bg-warning')}"
                                           th:text="${deal.stage}"></span>
        </div>

        <a href="/deals" class="btn btn-outline-secondary mb-4">← Назад к списку</a>

        <form th:action="@{/deals/update/{id}(id=${deal.id})}" method="post">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Название сделки:</label>
                    <input type="text" class="form-control" name="dealName"
                           th:value="${deal.dealName}" required>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Клиент:</label>
                    <select class="form-select" name="clientId" required>
                        <option th:each="client : ${clients}"
                                th:value="${client.id}"
                                th:selected="${deal.client != null && deal.client.id == client.id}"
                                th:text="${client.companyName}">
                        </option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Сумма (руб):</label>
                    <input type="number" class="form-control" name="amount"
                           step="0.01" min="1" required
                           th:value="${deal.amount}">
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Стадия:</label>
                    <select class="form-select" name="stage" required>
                        <option value="Переговоры" th:selected="${deal.stage == 'Переговоры'}">Переговоры</option>
                        <option value="В работе" th:selected="${deal.stage == 'В работе'}">В работе</option>
                        <option value="Оплачена" th:selected="${deal.stage == 'Оплачена'}">Оплачена</option>
                        <option value="Закрыта" th:selected="${deal.stage == 'Закрыта'}">Закрыта</option>
                        <option value="Отменена" th:selected="${deal.stage == 'Отменена'}">Отменена</option>
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Ответственный:</label>
                    <select class="form-select" name="responsibleUserId" required>
                        <option th:each="user : ${users}"
                                th:value="${user.id}"
                                th:selected="${deal.responsibleUser != null && deal.responsibleUser.id == user.id}"
                                th:text="${user.lastName + ' ' + user.firstName}">
                        </option>
                    </select>
                </div>

                <div class="col-md-6 mb-3">
                    <label class="form-label">Дедлайн:</label>
                    <input type="date" class="form-control" name="deadlineDate"
                           th:value="${deal.deadlineDate != null ? #temporals.format(deal.deadlineDate, 'yyyy-MM-dd') : ''}">
                </div>
            </div>

            <div class="d-flex justify-content-between mt-4">
                <button type="submit" class="btn btn-warning px-4">
                    <i class="bi bi-check-circle"></i> Обновить сделку
                </button>
                <a th:href="@{/deals/view/{id}(id=${deal.id})}" class="btn btn-info">
                    <i class="bi bi-eye"></i> Просмотр
                </a>
                <a href="/deals" class="btn btn-secondary">Отмена</a>
            </div>
        </form>
    </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</body>
</html>